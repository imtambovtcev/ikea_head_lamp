
âš ï¸  Note: Button Controls test requires manual interaction!

Press Enter to start all tests...
======================================================================
                    IKEA HEAD LAMP TEST SUITE
======================================================================

Running 6 test suites...

[1/6] Running: Basic Commands


======================================================================
                       Basic MQTT Commands Test                       
======================================================================

ğŸ“¡ Connecting to broker...
   Host: 192.168.50.247:1883
   Topic: ikea_head_lamp

âœ“ Connected

ğŸ“‹ Step 0: Resetting state (power off)

ğŸ“‹ Step 1: Power ON command
âœ“ PASS: state/json.pwr
  Expected: 1

ğŸ“‹ Step 2: Power OFF command
âœ“ PASS: state/json.pwr
  Expected: 0

ğŸ“‹ Step 3: Power Toggle (should turn ON)
âœ“ PASS: state/json.pwr
  Expected: 1

ğŸ“‹ Step 4: Set brightness to 50%
âœ“ PASS: state/json.bri
  Expected: 50

ğŸ“‹ Step 5: Set color to warm white (255,147,41)
âœ“ PASS: Color RGB values
  Expected: [255, 147, 41]

ğŸ“‹ Step 6: Set color to blue (0,100,255)
âœ“ PASS: Color RGB values
  Expected: [0, 100, 255]

ğŸ“‹ Step 7: Set brightness to 100%
âœ“ PASS: state/json.bri
  Expected: 100

ğŸ“‹ Step 8: Set brightness to 10%
âœ“ PASS: state/json.bri
  Expected: 10

ğŸ“‹ Step 9: Apply default settings
âœ“ PASS: state/json.pwr
  Expected: 1


======================================================================
âœ“ ALL TESTS PASSED: 9/9
======================================================================

----------------------------------------------------------------------

[2/6] Running: Configuration


======================================================================
                    Configuration Management Test                     
======================================================================

ğŸ“¡ Connecting to broker...
   Host: 192.168.50.247:1883
   Topic: ikea_head_lamp

âœ“ Connected

ğŸ“‹ Step 0: Resetting state (power off)

ğŸ“‹ Step 1: Request current configuration
Config State:
  default_brightness: 70
  default_color: [255, 147, 41]
  sunrise_minutes: 30
  sunrise_final_brightness: 100
  min_pwm: 20
  max_pwm: 100
  favorite_animation: fire
  favorite_params: [70, 5, 0]
  favorite_color: [0, 0, 0]
  version: 3
âœ“ PASS: Config received successfully
  Expected: Valid JSON config

ğŸ“‹ Step 2: Set default brightness to 80
âœ“ PASS: Default brightness updated
  Expected: 80

ğŸ“‹ Step 3: Set default color to cool white (200,220,255)
âœ“ PASS: Default color updated
  Expected: [200, 220, 255]

ğŸ“‹ Step 4: Set sunrise duration to 15 minutes
âœ“ PASS: Sunrise duration updated
  Expected: 15

ğŸ“‹ Step 5: Save configuration to NVS
âœ“ PASS: Config save command sent
  Expected: Saved

ğŸ“‹ Step 6: Verify config was saved
Config State:
  default_brightness: 80
  default_color: [200, 220, 255]
  sunrise_minutes: 15
  sunrise_final_brightness: 100
  min_pwm: 20
  max_pwm: 100
  favorite_animation: fire
  favorite_params: [70, 5, 0]
  favorite_color: [0, 0, 0]
  version: 4
âœ“ PASS: All config values persisted
  Expected: brightness=80, color=[200,220,255], sunrise=15

ğŸ“‹ Step 7: Reset configuration to defaults
Config State:
  default_brightness: 70
  default_color: [255, 147, 41]
  sunrise_minutes: 30
  sunrise_final_brightness: 100
  min_pwm: 20
  max_pwm: 100
  favorite_animation: fire
  favorite_params: [70, 5, 0]
  favorite_color: [0, 0, 0]
  version: 3
âœ“ PASS: Config reset to defaults
  Expected: 70


======================================================================
âœ“ ALL TESTS PASSED: 7/7
======================================================================

----------------------------------------------------------------------

[3/6] Running: Animations


======================================================================
                         Animation Test Suite                         
======================================================================

ğŸ“¡ Connecting to broker...
   Host: 192.168.50.247:1883
   Topic: ikea_head_lamp

âœ“ Connected

ğŸ“‹ Step 0: Resetting state (power off)

ğŸ“‹ Step 1: Fire animation (intensity=80, speed=6)
âœ“ PASS: state/json.anim
  Expected: fire

ğŸ“‹ Step 2: Ocean animation (speed=6)
âœ“ PASS: state/json.anim
  Expected: ocean

ğŸ“‹ Step 3: Breathe animation (duration=3s, pink color)
âœ“ PASS: state/json.anim
  Expected: breathe
âœ“ PASS: Breathe color parameters
  Expected: [255, 50, 150]

ğŸ“‹ Step 4: Rainbow animation
âœ“ PASS: state/json.anim
  Expected: rainbow

ğŸ“‹ Step 5: Stop animation
âœ“ PASS: state/json.anim
  Expected: 


======================================================================
âœ“ ALL TESTS PASSED: 6/6
======================================================================

----------------------------------------------------------------------

[4/6] Running: Pause/Play


======================================================================
                      Animation Pause/Play Test                       
======================================================================

ğŸ“¡ Connecting to broker...
   Host: 192.168.50.247:1883
   Topic: ikea_head_lamp

âœ“ Connected

ğŸ“‹ Step 0: Resetting state (power off)

ğŸ“‹ Step 1: Starting rainbow animation for testing
âœ“ PASS: state/json.anim
  Expected: rainbow

ğŸ“‹ Step 2: Pause the animation
âœ“ PASS: state/json.pause
  Expected: 1

ğŸ“‹ Step 3: Unpause the animation
âœ“ PASS: state/json.pause
  Expected: 0

ğŸ“‹ Step 4: Toggle pause (should pause)
âœ“ PASS: state/json.pause
  Expected: 1

ğŸ“‹ Step 5: Toggle pause again (should unpause)
âœ“ PASS: state/json.pause
  Expected: 0

ğŸ“‹ Step 6: Pause with "1"
âœ“ PASS: state/json.pause
  Expected: 1

ğŸ“‹ Step 7: Unpause with "0"
âœ“ PASS: state/json.pause
  Expected: 0


======================================================================
âœ“ ALL TESTS PASSED: 7/7
======================================================================

----------------------------------------------------------------------

[5/6] Running: Favorite Animation


======================================================================
                   Favorite Animation Feature Test                    
======================================================================

ğŸ“¡ Connecting to broker...
   Host: 192.168.50.247:1883
   Topic: ikea_head_lamp

âœ“ Connected

ğŸ“‹ Step 0: Resetting state (power off)

ğŸ“‹ Step 1: Request config to see default favorite animation
Config State:
  default_brightness: 70
  default_color: [255, 147, 41]
  sunrise_minutes: 30
  sunrise_final_brightness: 100
  min_pwm: 20
  max_pwm: 100
  favorite_animation: fire
  favorite_params: [70, 5, 0]
  favorite_color: [0, 0, 0]
  version: 3
âœ“ PASS: Config contains favorite_animation field
  Expected: 'favorite_animation' field present
âœ“ PASS: Default favorite is 'fire'
  Expected: fire
âœ“ PASS: Default fire intensity is 70
  Expected: 70

ğŸ“‹ Step 2: Start favorite animation (should trigger fire)
âœ“ PASS: state/json.anim
  Expected: fire

ğŸ“‹ Step 3: Change favorite animation to rainbow
ğŸ“‹ Step 4: Verify config shows rainbow as favorite
Config State:
  default_brightness: 70
  default_color: [255, 147, 41]
  sunrise_minutes: 30
  sunrise_final_brightness: 100
  min_pwm: 20
  max_pwm: 100
  favorite_animation: fire
  favorite_params: [70, 5, 0]
  favorite_color: [0, 0, 0]
  version: 3
âœ— FAIL: Favorite changed to 'rainbow'
  Expected: rainbow
  Actual:   fire

ğŸ“‹ Step 5: Save config to NVS flash
ğŸ“‹ Step 6: Start favorite animation (should now trigger rainbow)
âœ— FAIL: state/json.anim
  Full message: {'pwr': 1, 'bri': 24, 'rgb': [255, 109, 0], 'anim': 'fire', 'pause': 0, 'prog': 0, 'dur': 0, 'final_bri': 0, 'final_rgb': [0, 0, 0], 'end': 'loop', 'ver': 1270}
  Expected: rainbow
  Actual:   fire

ğŸ“‹ Step 7: Change favorite to ocean with custom params (speed=8, brightness=50)
ğŸ“‹ Step 8: Verify config shows ocean with parameters
Config State:
  default_brightness: 70
  default_color: [255, 147, 41]
  sunrise_minutes: 30
  sunrise_final_brightness: 100
  min_pwm: 20
  max_pwm: 100
  favorite_animation: fire
  favorite_params: [70, 5, 0]
  favorite_color: [0, 0, 0]
  version: 3
âœ— FAIL: Favorite changed to 'ocean'
  Expected: ocean
  Actual:   fire
âœ— FAIL: Ocean brightness parameter
  Expected: 50
  Actual:   70
âœ— FAIL: Ocean speed parameter
  Expected: 8
  Actual:   5

ğŸ“‹ Step 9: Save config
ğŸ“‹ Step 10: Start favorite animation (should trigger ocean)
âœ— FAIL: state/json.anim
  Full message: {'pwr': 1, 'bri': 47, 'rgb': [255, 155, 0], 'anim': 'fire', 'pause': 0, 'prog': 0, 'dur': 0, 'final_bri': 0, 'final_rgb': [0, 0, 0], 'end': 'loop', 'ver': 1656}
  Expected: ocean
  Actual:   fire

======================================================================
âœ— SOME TESTS FAILED: 4/10 passed
======================================================================

----------------------------------------------------------------------

[6/6] Running: Button Controls (Manual)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  MANUAL BUTTON TEST - USER INTERACTION REQUIRED              â•‘
â•‘  Please have your device ready and be prepared to press       â•‘
â•‘  the button when prompted!                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Press Enter when ready to start button tests...
======================================================================
                    Button Controls Test (Manual)                     
======================================================================

ğŸ“¡ Connecting to broker...
   Host: 192.168.50.247:1883
   Topic: ikea_head_lamp

âœ“ Connected

âš ï¸  This test requires manual button presses!

ğŸ“‹ Step 1: Test Single Click (Power Toggle)
ğŸ‘‰ Please press the button ONCE (single click)
   Expected: Power toggles ON or OFF
   Waiting 10 seconds for button press...

âœ“ Power changed: 0 â†’ 1

ğŸ“‹ Step 2: Test Long Press (Pause/Play Animation)
   First, starting an animation...
ğŸ‘‰ Please HOLD the button for ~1 second (long press)
   Expected: Animation pauses
   Waiting 10 seconds for button press...

âœ“ Animation paused

ğŸ‘‰ Please HOLD the button again to unpause
   Waiting 10 seconds...

âœ“ Animation unpaused

ğŸ“‹ Step 3: Test Double Click (Favorite Animation)
ğŸ‘‰ Please press the button TWICE quickly (double click)
   Expected: Favorite animation starts
   Waiting 10 seconds for button press...

   Favorite animation is: fire

âœ“ Favorite animation 'fire' started


======================================================================
âœ“ ALL TESTS PASSED: 4/4
======================================================================

----------------------------------------------------------------------


======================================================================
                        TEST SUMMARY
======================================================================

  âœ“ PASS - Basic Commands
  âœ“ PASS - Configuration
  âœ“ PASS - Animations
  âœ“ PASS - Pause/Play
  âœ— FAIL - Favorite Animation
  âœ“ PASS - Button Controls (Manual)

----------------------------------------------------------------------
âœ— SOME TESTS FAILED: 5/6 passed
